# 云舟系统核心设计原则 (Yunzhou System Core Principles)

> **开发者说明**: 本文档根据用户的核心业务逻辑制定，是整个云舟系统的最高设计准则。所有功能开发、数据处理和逻辑迭代，都必须严格遵守此文档中定义的规则。在每次开发任务开始前，都应重新阅读并确认所有逻辑均符合以下原则。

---

## 1. 核心设计原则 (Core Design Principles)

- **SKU 中心化 (SKU-Centric Architecture)**: 整个系统的核心是 **SKU 的唯一值**。所有功能，包括数据聚合、利润分析、销售预测、库存管理、AI 洞察等，都必须围绕 SKU 展开。所有的数据关联和穿透查询，最终都必须能够落到具体的 SKU 物理资产上。

---

## 2. 数据源黄金准则 (Golden Rules for Data Sources)

为确保全链路数据口径的绝对统一，所有核心指标的来源必须严格遵守以下规定：

- **销售指标 (GMV, CA)**:
  - **唯一来源**: `fact_shangzhi` (商智事实表)。
  - **关键字段**:
    - **GMV (成交金额)**: 来源于 `paid_amount` 字段。
    - **CA (成交件数)**: 来源于 `paid_items` 字段。
  - **禁止**: 任何其他数据表（如广告表）中的销售额相关字段，都不能用于核心的销售业绩统计，仅可用于归因分析。

- **广告花费 (SPEND)**:
  - **唯一来源**: `fact_jingzhuntong` (广告事实表)。
  - **关键字段**: 来源于 `cost` 字段。

---

## 3. 时间维度定义 (Time Dimension Definitions)

- **基准时区 (Standard Timezone)**:
  - 系统所有涉及日期计算、展示和筛选的功能，都必须以 **中国区北京时间 (UTC+8)** 为唯一标准。

- **相对时间范围定义 (Relative Time Range Definitions)**:
  - **"实时" (Realtime)**: 指的是系统中有数据的最新一天（Data Anchor Date）。
  - **"昨日" (Yesterday)**: 指的是数据最新一天的前一天。
  - **"近7天" (Last 7 Days)**: 指的是**从数据最新一天（Data Anchor Date）往前数，共计7天**的闭区间。例如，如果最新数据是 `2026-01-29`，则“近7天”的范围是 `[2026-01-23, 2026-01-29]`。
  - **"近30天" (Last 30 Days)**: 指的是**从数据最新一天（Data Anchor Date）往前数，共计30天**的闭区间。例如，如果最新数据是 `2026-01-29`，则“近30天”的范围是 `[2025-12-31, 2026-01-29]`。
  
---

## 4. 数据拉取窗口 (Data Fetch Window)

- **战略指挥控制台 (Dashboard)**:
  - 为确保环比计算的性能与数据完整性，控制台在加载时会**按数据库最新数据时间（Data Anchor Date）向前追溯 60 天**，拉取此窗口内的全部商智与广告事实数据作为计算基础。
